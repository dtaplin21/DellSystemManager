Stripe client initialized successfully
✅ connected-workflow.js route file loaded
[2025-10-15T00:39:28.789Z] [INFO] WebSocket server initialized
[2025-10-15T00:39:28.790Z] [INFO] Server running on http://0.0.0.0:8003
[2025-10-15T00:39:28.790Z] [INFO] AI services status {"aiServiceAvailable":true,"openaiServiceAvailable":true}
[2025-10-15T00:39:29.599Z] [INFO] Successfully connected to PostgreSQL database {"host":"aws-0-us-east-2.pooler.supabase.com","database":"postgres","port":6543,"ssl":"enabled"}
[2025-10-15T00:39:29.809Z] [INFO] Connected to PostgreSQL database
[2025-10-15T00:39:29.810Z] [INFO] Applying database migrations
[2025-10-15T00:39:30.585Z] [INFO] Database migrations completed successfully
[2025-10-15T00:39:45.530Z] [WARN] [AUTH] Development bypass enabled - using mock authentication
📥 [ASBUILT] Import request for project 49e74875-5d29-4027-a817-d53602e68e4c, scope: project-wide
📁 [ASBUILT] Processing Excel file: 3589cf62-d099-4751-9388-6efef50edc44.xlsx (57201 bytes)
🤖 [ASBUILT] Processing domain: auto-detect
🤖 [AI] ===== STARTING IMPORT =====
🤖 [AI] Starting import for project 49e74875-5d29-4027-a817-d53602e68e4c, domain: null
🤖 [AI] Domain type: object, value: null
🤖 [AI] File buffer size: 57201 bytes
📊 [AI] Total rows in Excel: 649
📊 [AI] Found 11 header rows at positions: [
   20,  79, 138, 197,
  256, 315, 374, 433,
  492, 551, 610
]
⚠️ [AI] Multiple sections detected with identical headers
📊 [AI] Multi-section file detected, processing with deduplication...
📊 [AI] Processing 11 sections...
📊 [AI] Section 1: rows 21-79
✅ [AI] Keeping panel 1 (normalized P001) from section 1
✅ [AI] Keeping panel 2 (normalized P002) from section 1
✅ [AI] Keeping panel 3 (normalized P003) from section 1
✅ [AI] Keeping panel 4 (normalized P004) from section 1
✅ [AI] Keeping panel 5 (normalized P005) from section 1
✅ [AI] Keeping panel 6 (normalized P006) from section 1
✅ [AI] Keeping panel 7 (normalized P007) from section 1
⚠️ [AI] Unable to normalize panel number in section 1; keeping row
⚠️ [AI] Unable to normalize panel number in section 1; keeping row
⚠️ [AI] Unable to normalize panel number in section 1; keeping row
🚫 [AI] Skipping duplicate panel WPWM MOD 6 (normalized P006) from section 1
⚠️ [AI] Unable to normalize panel number in section 1; keeping row
⚠️ [AI] Unable to normalize panel number in section 1; keeping row
⚠️ [AI] Unable to normalize panel number in section 1; keeping row
⚠️ [AI] Unable to normalize panel number in section 1; keeping row
📊 [AI] Section 2: rows 80-138
✅ [AI] Keeping panel 8 (normalized P008) from section 2
✅ [AI] Keeping panel 9 (normalized P009) from section 2
✅ [AI] Keeping panel 10 (normalized P010) from section 2
✅ [AI] Keeping panel 11 (normalized P011) from section 2
✅ [AI] Keeping panel 12 (normalized P012) from section 2
✅ [AI] Keeping panel 13 (normalized P013) from section 2
✅ [AI] Keeping panel 14 (normalized P014) from section 2
⚠️ [AI] Unable to normalize panel number in section 2; keeping row
⚠️ [AI] Unable to normalize panel number in section 2; keeping row
⚠️ [AI] Unable to normalize panel number in section 2; keeping row
🚫 [AI] Skipping duplicate panel WPWM MOD 6 (normalized P006) from section 2
⚠️ [AI] Unable to normalize panel number in section 2; keeping row
⚠️ [AI] Unable to normalize panel number in section 2; keeping row
⚠️ [AI] Unable to normalize panel number in section 2; keeping row
⚠️ [AI] Unable to normalize panel number in section 2; keeping row
📊 [AI] Section 3: rows 139-197
✅ [AI] Keeping panel 15 (normalized P015) from section 3
✅ [AI] Keeping panel 16 (normalized P016) from section 3
✅ [AI] Keeping panel 17 (normalized P017) from section 3
✅ [AI] Keeping panel 18 (normalized P018) from section 3
✅ [AI] Keeping panel 19 (normalized P019) from section 3
✅ [AI] Keeping panel 20 (normalized P020) from section 3
✅ [AI] Keeping panel 21 (normalized P021) from section 3
⚠️ [AI] Unable to normalize panel number in section 3; keeping row
⚠️ [AI] Unable to normalize panel number in section 3; keeping row
⚠️ [AI] Unable to normalize panel number in section 3; keeping row
🚫 [AI] Skipping duplicate panel WPWM MOD 6 (normalized P006) from section 3
⚠️ [AI] Unable to normalize panel number in section 3; keeping row
⚠️ [AI] Unable to normalize panel number in section 3; keeping row
⚠️ [AI] Unable to normalize panel number in section 3; keeping row
⚠️ [AI] Unable to normalize panel number in section 3; keeping row
📊 [AI] Section 4: rows 198-256
✅ [AI] Keeping panel 22 (normalized P022) from section 4
✅ [AI] Keeping panel 23 (normalized P023) from section 4
✅ [AI] Keeping panel 24 (normalized P024) from section 4
✅ [AI] Keeping panel 25 (normalized P025) from section 4
⚠️ [AI] Unable to normalize panel number in section 4; keeping row
⚠️ [AI] Unable to normalize panel number in section 4; keeping row
⚠️ [AI] Unable to normalize panel number in section 4; keeping row
🚫 [AI] Skipping duplicate panel WPWM MOD 6 (normalized P006) from section 4
⚠️ [AI] Unable to normalize panel number in section 4; keeping row
⚠️ [AI] Unable to normalize panel number in section 4; keeping row
⚠️ [AI] Unable to normalize panel number in section 4; keeping row
⚠️ [AI] Unable to normalize panel number in section 4; keeping row
📊 [AI] Section 5: rows 257-315
✅ [AI] Keeping panel 26 (normalized P026) from section 5
✅ [AI] Keeping panel 27 (normalized P027) from section 5
✅ [AI] Keeping panel 28 (normalized P028) from section 5
✅ [AI] Keeping panel 29 (normalized P029) from section 5
✅ [AI] Keeping panel 30 (normalized P030) from section 5
✅ [AI] Keeping panel 31 (normalized P031) from section 5
✅ [AI] Keeping panel 32 (normalized P032) from section 5
⚠️ [AI] Unable to normalize panel number in section 5; keeping row
⚠️ [AI] Unable to normalize panel number in section 5; keeping row
⚠️ [AI] Unable to normalize panel number in section 5; keeping row
🚫 [AI] Skipping duplicate panel WPWM MOD 6 (normalized P006) from section 5
⚠️ [AI] Unable to normalize panel number in section 5; keeping row
⚠️ [AI] Unable to normalize panel number in section 5; keeping row
⚠️ [AI] Unable to normalize panel number in section 5; keeping row
⚠️ [AI] Unable to normalize panel number in section 5; keeping row
📊 [AI] Section 6: rows 316-374
✅ [AI] Keeping panel 33 (normalized P033) from section 6
⚠️ [AI] Unable to normalize panel number in section 6; keeping row
⚠️ [AI] Unable to normalize panel number in section 6; keeping row
⚠️ [AI] Unable to normalize panel number in section 6; keeping row
🚫 [AI] Skipping duplicate panel WPWM MOD 6 (normalized P006) from section 6
⚠️ [AI] Unable to normalize panel number in section 6; keeping row
⚠️ [AI] Unable to normalize panel number in section 6; keeping row
⚠️ [AI] Unable to normalize panel number in section 6; keeping row
⚠️ [AI] Unable to normalize panel number in section 6; keeping row
📊 [AI] Section 7: rows 375-433
✅ [AI] Keeping panel 34 (normalized P034) from section 7
✅ [AI] Keeping panel 35 (normalized P035) from section 7
⚠️ [AI] Unable to normalize panel number in section 7; keeping row
⚠️ [AI] Unable to normalize panel number in section 7; keeping row
⚠️ [AI] Unable to normalize panel number in section 7; keeping row
🚫 [AI] Skipping duplicate panel WPWM MOD 6 (normalized P006) from section 7
⚠️ [AI] Unable to normalize panel number in section 7; keeping row
⚠️ [AI] Unable to normalize panel number in section 7; keeping row
⚠️ [AI] Unable to normalize panel number in section 7; keeping row
⚠️ [AI] Unable to normalize panel number in section 7; keeping row
📊 [AI] Section 8: rows 434-492
✅ [AI] Keeping panel 36 (normalized P036) from section 8
✅ [AI] Keeping panel 37 (normalized P037) from section 8
✅ [AI] Keeping panel 38 (normalized P038) from section 8
✅ [AI] Keeping panel 39 (normalized P039) from section 8
✅ [AI] Keeping panel 40 (normalized P040) from section 8
⚠️ [AI] Unable to normalize panel number in section 8; keeping row
⚠️ [AI] Unable to normalize panel number in section 8; keeping row
⚠️ [AI] Unable to normalize panel number in section 8; keeping row
🚫 [AI] Skipping duplicate panel WPWM MOD 6 (normalized P006) from section 8
⚠️ [AI] Unable to normalize panel number in section 8; keeping row
⚠️ [AI] Unable to normalize panel number in section 8; keeping row
⚠️ [AI] Unable to normalize panel number in section 8; keeping row
⚠️ [AI] Unable to normalize panel number in section 8; keeping row
📊 [AI] Section 9: rows 493-551
✅ [AI] Keeping panel 41 (normalized P041) from section 9
✅ [AI] Keeping panel 42 (normalized P042) from section 9
✅ [AI] Keeping panel 43 (normalized P043) from section 9
✅ [AI] Keeping panel 44 (normalized P044) from section 9
✅ [AI] Keeping panel 45 (normalized P045) from section 9
✅ [AI] Keeping panel 46 (normalized P046) from section 9
⚠️ [AI] Unable to normalize panel number in section 9; keeping row
⚠️ [AI] Unable to normalize panel number in section 9; keeping row
⚠️ [AI] Unable to normalize panel number in section 9; keeping row
🚫 [AI] Skipping duplicate panel WPWM MOD 6 (normalized P006) from section 9
⚠️ [AI] Unable to normalize panel number in section 9; keeping row
⚠️ [AI] Unable to normalize panel number in section 9; keeping row
⚠️ [AI] Unable to normalize panel number in section 9; keeping row
⚠️ [AI] Unable to normalize panel number in section 9; keeping row
📊 [AI] Section 10: rows 552-610
✅ [AI] Keeping panel 47 (normalized P047) from section 10
✅ [AI] Keeping panel 48 (normalized P048) from section 10
✅ [AI] Keeping panel 49 (normalized P049) from section 10
✅ [AI] Keeping panel 50 (normalized P050) from section 10
✅ [AI] Keeping panel 51 (normalized P051) from section 10
✅ [AI] Keeping panel 52 (normalized P052) from section 10
✅ [AI] Keeping panel 53 (normalized P053) from section 10
✅ [AI] Keeping panel 54 (normalized P054) from section 10
⚠️ [AI] Unable to normalize panel number in section 10; keeping row
⚠️ [AI] Unable to normalize panel number in section 10; keeping row
⚠️ [AI] Unable to normalize panel number in section 10; keeping row
🚫 [AI] Skipping duplicate panel WPWM MOD 6 (normalized P006) from section 10
⚠️ [AI] Unable to normalize panel number in section 10; keeping row
⚠️ [AI] Unable to normalize panel number in section 10; keeping row
⚠️ [AI] Unable to normalize panel number in section 10; keeping row
⚠️ [AI] Unable to normalize panel number in section 10; keeping row
📊 [AI] Section 11: rows 611-649
✅ [AI] Keeping panel 55 (normalized P055) from section 11
✅ [AI] Keeping panel 56 (normalized P056) from section 11
✅ [AI] Keeping panel 57 (normalized P057) from section 11
✅ [AI] Keeping panel 58 (normalized P058) from section 11
✅ [AI] Keeping panel 59 (normalized P059) from section 11
✅ [AI] Keeping panel 60 (normalized P060) from section 11
✅ [AI] Keeping panel 61 (normalized P061) from section 11
✅ [AI] Keeping panel 62 (normalized P062) from section 11
✅ [AI] Keeping panel 63 (normalized P063) from section 11
📊 [AI] Total unique panels after deduplication: 133
📊 [AI] Parsed 133 rows with 11 columns
🎯 [AI] Domain scores: {
  panel_placement: 3,
  panel_seaming: 0,
  non_destructive: 0,
  trial_weld: 0,
  repairs: 0,
  destructive: 0
}
🎯 [AI] Best domain: panel_placement (score: 3)
🤖 [AI] Using Claude for domain detection...
🤖 [AI] Claude analyzing domain for headers: , Date, Panel #, Length, Width, Roll Number, , Panel Location / Comment, , , 
❌ [AI] Import failed: BadRequestError: 400 {"type":"error","error":{"type":"invalid_request_error","message":"Your credit balance is too low to access the Anthropic API. Please go to Plans & Billing to upgrade or purchase credits."},"request_id":"req_011CU83zcZTT24qa68DKHxqn"}
    at APIError.generate (/Users/dtaplin21/DellSystemManager/backend/node_modules/@anthropic-ai/sdk/core/error.js:41:20)
    at Anthropic.makeStatusError (/Users/dtaplin21/DellSystemManager/backend/node_modules/@anthropic-ai/sdk/client.js:155:32)
    at Anthropic.makeRequest (/Users/dtaplin21/DellSystemManager/backend/node_modules/@anthropic-ai/sdk/client.js:309:30)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async AsbuiltImportAI.aiDetectDomain (/Users/dtaplin21/DellSystemManager/backend/services/asbuiltImportAI.js:594:21)
    at async AsbuiltImportAI.detectDomain (/Users/dtaplin21/DellSystemManager/backend/services/asbuiltImportAI.js:555:28)
    at async AsbuiltImportAI.importExcelData (/Users/dtaplin21/DellSystemManager/backend/services/asbuiltImportAI.js:130:40)
    at async /Users/dtaplin21/DellSystemManager/backend/routes/asbuilt.js:332:30 {
  status: 400,
  headers: Headers {
    date: 'Wed, 15 Oct 2025 00:39:46 GMT',
    'content-type': 'application/json',
    'content-length': '234',
    connection: 'keep-alive',
    'cf-ray': '98eb42e0b8da2513-SJC',
    'x-should-retry': 'false',
    'request-id': 'req_011CU83zcZTT24qa68DKHxqn',
    'strict-transport-security': 'max-age=31536000; includeSubDomains; preload',
    'anthropic-organization-id': '8bbe75a3-4ffe-4c04-818c-31abcd6edb25',
    'x-envoy-upstream-service-time': '40',
    via: '1.1 google',
    'cf-cache-status': 'DYNAMIC',
    'x-robots-tag': 'none',
    server: 'cloudflare'
  },
  requestID: 'req_011CU83zcZTT24qa68DKHxqn',
  error: {
    type: 'error',
    error: {
      type: 'invalid_request_error',
      message: 'Your credit balance is too low to access the Anthropic API. Please go to Plans & Billing to upgrade or purchase credits.'
    },
    request_id: 'req_011CU83zcZTT24qa68DKHxqn'
  }
}
⚠️ [ASBUILT] Error processing domain auto-detect: 400 {"type":"error","error":{"type":"invalid_request_error","message":"Your credit balance is too low to access the Anthropic API. Please go to Plans & Billing to upgrade or purchase credits."},"request_id":"req_011CU83zcZTT24qa68DKHxqn"}
✅ [ASBUILT] Import completed: 0 records created
🎯 [ASBUILT] Detected panels: []
[2025-10-15T00:39:46.085Z] [WARN] [AUTH] Development bypass enabled - using mock authentication
🔍 [ASBUILT] Fetching records for project 49e74875-5d29-4027-a817-d53602e68e4c
